
var openpgp = $.getScript('/theme/js/openpgp.js');

openpgp.initWorker({ path: '/theme/js/openpgp.worker.js' })

var pubkey = `-----BEGIN PGP PUBLIC KEY BLOCK-----

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
=QVLk
-----END PGP PUBLIC KEY BLOCK-----`;

// var Base64 = {
//   _keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
// 
//   encode: function(e) {
//     var t = "";
//     var n,r,i,s,o,u,a;
//     var f = 0;
//     e = Base64._utf8_encode(e);
//     while ( f < e.length ) {
//       n = e.charCodeAt(f++);
//       r = e.charCodeAt(f++);
//       i = e.charCodeAt(f++);
//       s = n >> 2;
//       o = ( n & 3 ) << 4 | r >> 4;
//       u = ( r & 15 )<< 2 | i >> 6;
//       a = i & 63;
//       if ( isNaN(r) ) {
//         u = a = 64;
//       } else if ( isNaN(i) ) {
//         a = 64;
//       }
//       t = t + this._keyStr.charAt(s)
//         + this._keyStr.charAt(o)
//         + this._keyStr.charAt(u)
//         + this._keyStr.charAt(a);
//     }
//     return t
//   },
//   decode: function(e) {
//     var t = "";
//     var n,r,i;
//     var s,o,u,a;
//     var f = 0;
//     e = e.replace(/[^A-Za-z0-9+/=]/g,"");
//     while (f < e.length ) {
//       s = this._keyStr.indexOf(e.charAt(f++));
//       o = this._keyStr.indexOf(e.charAt(f++));
//       u = this._keyStr.indexOf(e.charAt(f++));
//       a = this._keyStr.indexOf(e.charAt(f++));
//       n = s << 2 | o >> 4;
//       r = ( o & 15 ) << 4 | u >> 2;
//       i = (u & 3 ) << 6 | a;
//       t = t + String.fromCharCode(n);
//       if ( u !=64 ) {
//         t = t + String.fromCharCode(r);
//       }
//       if ( a != 64 ) {
//         t = t + String.fromCharCode(i);
//       }
//     }
//     t = Base64._utf8_decode(t);
//     return t;
//   },
//   _utf8_encode: function(e) {
//     e = e.replace(/rn/g,"n");
//     var t = "";
//     for ( var n = 0; n < e.length; n++) {
//       var r = e.charCodeAt(n);
//       if ( r < 128 ) {
//         t += String.fromCharCode(r);
//       } else if ( r > 127 && r < 2048 ) {
//         t += String.fromCharCode( r >> 6 | 192 );
//         t += String.fromCharCode( r & 63 |128 );
//       } else {
//         t += String.fromCharCode( r >> 12 | 224 );
//         t += String.fromCharCode( r >> 6 & 63 | 128);
//         t += String.fromCharCode( r & 63 | 128);
//       }
//     }
//     return t
//   },
//   _utf8_decode: function(e) {
//     var t = "";
//     var n = 0;
//     var r = c1 = c2 =0;
//     while ( n < e.length ) {
//       r = e.charCodeAt(n);
//       if ( r < 128 ) {
//         t += String.fromCharCode(r);
//         n++;
//       } else if ( r > 191 && r < 224 ) {
//         c2 = e.charCodeAt(n+1);
//         t += String.fromCharCode((r&31)<<6|c2&63);
//         n += 2;
//       } else {
//         c2 = e.charCodeAt(n+1);
//         c3 = e.charCodeAt(n+2);
//         t += String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);
//         n += 3;
//       }
//     }
//     return t;
//   }
// }
// function b64encode(string) {
//   return Base64.encode(string);
// }
// function b64decode(string) {
//   return Base64.decode(string);
// }

function beforeSubmit() {
  var name = $("input#name").val();
  var email = $("input#email").val();
  var message = $("textarea#message").val();

  var options = {
    data: 'Name: ' + name + '\n' + 'Email: ' + email + '\n' + 'Message: ' + message,
    publicKeys: openpgp.key.readArmored(pubkey).keys,
  };

  var encrypted;
  openpgp.encrypt(options).then(function(ciphertext){
    encrypted = ciphertext.data;
    //encrypted = Base64.encode(encrypted);
    alert(encrypted);

    //name.replace(name, 'name');
    //email.replace(email, 'name@example.com');
    //message.replace(message, encrypted);

    $.ajax({
      url: "https://formspree.io/jacobsvictims@gmail.com",
      crossDomain: true,
      type: "POST",
      data: { message: encrypted },
      cache: false,
      success: function() {
        $('#success').html("<div class='alert alert-success'>");
        $('#success > .alert-success').html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;")
          .append("</button>");
        $('#success > .alert-success')
          .append("<strong>Your message has been sent. </strong>");
        $('#success > .alert-success')
          .append('</div>');
        $('#contactForm').trigger("reset");
      },
      error: function(jqXHR, textStatus, errorThrown) {
        if (textStatus == "error") {
          $('#success').html("<div class='alert alert-success'>");
          $('#success > .alert-success').html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;")
            .append("</button>");
          $('#success > .alert-success')
            .append("<strong>Your message has been sent. </strong>");
          $('#success > .alert-success')
            .append('</div>');
          $('#contactForm').trigger("reset");
        } else {
          $('#success').html("<div class='alert alert-danger'>");
          $('#success > .alert-danger').html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;")
            .append("</button>");
          $('#success > .alert-danger').append("<strong>Sorry, it seems that my mail server is not responding. Please try again later!");
          $('#success > .alert-danger').append('</div>');
          $('#contactForm').trigger("reset");
        };
      },
    });
  }).catch(function(error) {
    alert('There was an error encrypting your message: \n' + error);
  });
  
  return false;
};

$(function() {
    $("input,textarea").jqBootstrapValidation({
        preventSubmit: true,
        submitError: function($form, event, errors) {
            // additional error messages or events
        },
        submitSuccess: function($form, event) {
            event.preventDefault(); // prevent default submit behaviour
        },
        filter: function() {
            return $(this).is(":visible");
        },
    });

    $("a[data-toggle=\"tab\"]").click(function(e) {
        e.preventDefault();
        $(this).tab("show");
    });
});


/*When clicking on Full hide fail/success boxes */
$('#name').focus(function() {
    $('#success').html('');
});
